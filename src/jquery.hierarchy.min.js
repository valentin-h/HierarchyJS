function Hierarchy(){return{data:[],html:"",preloads:[],preloaded:0,containers:{},injects:[],settings:{useFileAPI:!1,addTags:!1,addMenu:!0},getHTML:function(t,e){var i=e||!1;i&&(this.settings=$.extend({},this.settings,i));var a=this;if(this.data=t,this.parseData(),this.injectContents(),this.settings.addMenu&&this.data.length>1&&this.injectMenus(),this.settings.useFileAPI){var n=$.Deferred(),s=function(t,e){var i=$.parseHTML(a.html),s=$(i).find('*[data-stamp="'+e+'"]'),r=t,h='url("'+t+'")',l="";$(s).is("div")?$(s).css("background-image",h):$(s).is("img")&&$(s).attr("src",r);for(var o=0;o<$(i).length;o++)l+=$(i)[o].outerHTML;a.html=l,a.preloaded++,a.preloaded==a.preloads.length&&(a.settings.addTags&&a.injectTags(),n.resolve(a.html))};return a.preloads.length>0?a.preloads.forEach(function(t){var e=t.stamp,i=t.file;if("string"==typeof i)s(i,e);else{var a=new FileReader;a.onloadend=function(){s(a.result,e)},a.readAsDataURL(i)}}):(a.settings.addTags&&a.injectTags(),n.resolve(a.html)),n.promise()}return this.preloads.forEach(function(t){var e=t.stamp,i=t.file,a=$.parseHTML(this.html),n=$(a).find('*[data-stamp="'+e+'"]'),s=i,r="url('"+i+"')",h="";$(n).is("div")?$(n).css("background-image",r):$(n).is("img")&&$(n).attr("src",s);for(var l=0;l<$(a).length;l++)h+=$(a)[l].outerHTML;this.html=h},this),this.html},parseData:function(){this.html="",this.injects=[],this.containers={},this.preloads=[],this.preloaded=0,this.data.forEach(function(t,e,i){this.openSectionHTML(this.slugify(i[e].name),e);var a=this.resolvePriority(t),n=0,s=0,r=["","",""],h=[{image:0,text:0},{image:0,text:0},{image:0,text:0}];a.forEach(function(t,e){t.length>0&&n++;var i=0,a=0;t.forEach(function(t){var n=t.type;switch(n){case"image":i++,h[e].image=parseInt(h[e].image)+1;break;case"text":a++,h[e].text=parseInt(h[e].text)+1}s++},this),i>0&&0==a&&(r[e]="image"),0==i&&a>0&&(r[e]="text"),i>0&&a>0&&(r[e]="mixed")},this),a.forEach(function(t,i){t.forEach(function(t,a){var l=new Date,o=l.getTime()+"-"+e+"-"+i+"-"+a,c=this.determineContent(i,n,s,r,h,e,a,t,o);c.injection.done||(this.html+=c.html),"image"==t.type&&null!=t.data&&this.preloads.push({stamp:o,file:t.data})},this)},this),this.closeSectionHTML()},this)},resolvePriority:function(t){var e=[[],[],[]],i={};t.content.forEach(function(t){var e=t.priority,a=t.type;i[e]=i.hasOwnProperty(e)?i[e]:{},i[e][a]=i[e].hasOwnProperty(a)?i[e][a]:[],i[e][a].push(t)},this);for(var a in i){var n=i[a].hasOwnProperty("image")?i[a].image:!1,s=i[a].hasOwnProperty("text")?i[a].text:!1,r=parseInt(a)-1;n&&n.forEach(function(t){e[r].push(t)}),s&&s.forEach(function(t){e[r].push(t)})}return e.reverse()},determineContent:function(t,e,i,a,n,s,r,h,l){var o,c,m=3-parseInt(t),d=h.type,g="text"==d?h.data:"",f=!1,p={html:"",injection:{done:!1,section:s,target:"",html:""}};if(3==m&&"image"==d&&(f=this.hasContainerOrCreate(s,"hierarchy-3-img-container"),f||(p.html='<div data-stamp="'+l+'" class="hierarchy-3-img-container flex-centered"></div>')),2==m)if("image"==d)"mixed"==a[t]?n[t].image==n[t].text?n[t].image>1?(c=r%2==0?"float-left ":"float-right ",p.html+='<div class="hierarchy-2-mixed-container"><div data-stamp="'+l+'" class="hierarchy-2-mixed-img '+c+'"/></div>'):p.html+='<div class="hierarchy-2-img" data-stamp="'+l+'"></div>':n[t].image>n[t].text&&(0==r?p.html+='<ul class="hierarchy-2-slider"><li><img data-stamp="'+l+'" src=""/></li></ul>':(p.html+='<li><img data-stamp="'+l+'" src=""/></li>',p.injection.target=".hierarchy-2-slider",p.injection.html=p.html,p.injection.done=!0,this.injects.push(p.injection))):"image"==a[t]&&(p.html+='<div class="hierarchy-2-img" data-stamp="'+l+'"></div>');else if("mixed"==a[t])if(n[t].image==n[t].text)if(n[t].image>1){var u=parseInt(n[t].image)+parseInt(n[t].text),y=u/2,x=r-y;o=x+1,1>o&&(o=1),c=x%2==0?"float-left align-justify-left margin-top-med":"float-right align-justify-right margin-top-med",p.html+='<h2 class="hierarchy-2-mixed-title '+c+'">'+g+"</h2>",p.injection.target=".hierarchy-2-mixed-container:nth-child("+o+")",p.injection.html=p.html,p.injection.done=!0,this.injects.push(p.injection)}else p.html+='<h2 class="hierarchy-2-title margin-top-high '+c+'">'+g+"</h2>";else n[t].image>n[t].text&&(p.html+='<h2 class="hierarchy-2-title margin-top-high '+c+'">'+g+"</h2>");else"text"==a[t]&&(p.html+="<h2>"+g+"</h2>");return 1==m&&"text"==d&&("mixed"==a[1]?n[1].image==n[1].text?n[1].image>1?(o=r+1,c=o%2==0?"align-justify-right float-right ":"align-justify-left float-left ",p.html+='<p class="hierarchy-1-text-injected-in-2-mixed  margin-top-low '+c+'">'+g+"</p>",p.injection.target=".hierarchy-2-mixed-container:nth-child("+o+")",p.injection.html=p.html,p.injection.done=!0,this.injects.push(p.injection)):(c="align-justify-left",p.html+='<p class="hierarchy-1-text margin-top-med '+c+'">'+g+"</p>"):n[1].image>n[1].text&&(c="align-justify-left",p.html+='<p class="hierarchy-1-text margin-top-med '+c+'">'+g+"</p>"):"images"==a[1]),3!=m||"text"!=a[t]&&"mixed"!=a[t]||"text"!=d||(p.html+="<h1>"+g+"</h1>"),((1==m||2==m)&&("image"==a[0]||"mixed"==a[0])||3==m&&"text"==d&&"mixed"==a[0])&&(p.injection.done||(p.injection.target=".hierarchy-3-img-container",p.injection.html=p.html,p.injection.done=!0,this.injects.push(p.injection))),p},hasContainerOrCreate:function(t,e){var i=!1;return void 0==this.containers[t]?this.containers[t]=[e]:i=!0,i},injectContents:function(){var t=$.parseHTML(this.html),e="";this.injects.forEach(function(e){$(t[e.section]).find(e.target).append(e.html)});for(var i=0;i<$(t).length;i++)e+=$(t)[i].outerHTML;this.html=e},injectMenus:function(){var t="";t+='<header><ul id="main-menu">',this.data.forEach(function(e,i){t+=this.data.length>1&&i+1<this.data.length?'<li><p data-index="'+(i+1)+'" class="hierarchy-menu-link">'+e.name+'</p></li><li class="menu-picto"> â—˜ </li>':'<li><p data-index="'+(i+1)+'" class="hierarchy-menu-link">'+e.name+"</p></li>"},this),t+="</ul></header>",this.html=t+this.html},injectTags:function(){var t='<!DOCTYPE html><html><head lang="en"><meta charset="UTF-8"><title>Hierarchy</title></head><body>',e="</body></html>";this.html=t+this.html+e},openSectionHTML:function(t,e){this.html+='<section class="priority-section" id="'+t+'" data-index="'+e+'">'},closeSectionHTML:function(){this.html+="</section>"},slugify:function(t){return t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}}}